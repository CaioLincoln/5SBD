CREATE DATABASE INSTITUICAO;

CREATE TABLE `aluno` (`IDAluno` INT NOT NULL AUTO_INCREMENT , `Nome` VARCHAR(100) NOT NULL , `Nascimento` DATE NOT NULL , PRIMARY KEY (`IDAluno`)) ENGINE = InnoDB;

CREATE TABLE `turma` (`IDTurma` INT NOT NULL AUTO_INCREMENT , `Descricao` VARCHAR(200) NOT NULL , `Turno` VARCHAR(1) NOT NULL , PRIMARY KEY (`IDTurma`)) ENGINE = InnoDB;

CREATE TABLE `alunoturma` (`IDAluno` INT NOT NULL , `IDTurma` INT NOT NULL ) ENGINE = InnoDB;
ALTER TABLE `alunoturma` ADD CONSTRAINT `AlunoTurma_IDAluno` FOREIGN KEY (`IDAluno`) REFERENCES `aluno`(`IDAluno`) ON DELETE CASCADE ON UPDATE RESTRICT; ALTER TABLE `alunoturma` ADD CONSTRAINT `AlunoTurma_IDTurma` FOREIGN KEY (`IDTurma`) REFERENCES `turma`(`IDTurma`) ON DELETE CASCADE ON UPDATE RESTRICT;

CREATE TABLE `matricula` (`IDAluno` INT NOT NULL , `IDTurma` INT NOT NULL , `AV1` INT NOT NULL DEFAULT '0' , `AV2` INT NOT NULL DEFAULT '0' ,`Media` INT NOT NULL DEFAULT '0' , `Faltas` INT NOT NULL DEFAULT '0' , `Status` VARCHAR(1) NOT NULL DEFAULT 'A' ) ENGINE = InnoDB;
ALTER TABLE `matricula` ADD CONSTRAINT `IDAluno` FOREIGN KEY (`IDAluno`) REFERENCES `aluno`(`IDAluno`) ON DELETE CASCADE ON UPDATE RESTRICT;

SELECT t1.Nome 
	FROM aluno AS t1 
	INNER JOIN alunoturma AS t2 ON (t1.IDAluno = t2.IDAluno)
	INNER JOIN turma AS t3 ON (t2.IDTurma = t3.IDTurma) 
	WHERE t3.IDTurma = "1"
	ORDER BY t1.Nome;

SELECT t1.Nome,t2.AV1,t2.AV2,t2.Media,t2.Faltas
	FROM aluno AS t1 
	INNER JOIN matricula AS t2 ON (t1.IDAluno = t2.IDAluno)
	INNER JOIN turma AS t3 ON (t2.IDTurma = t3.IDTurma) 
	WHERE t3.IDAluno = "1" AND t3.IDTurma = "1"
	ORDER BY t1.Nome;